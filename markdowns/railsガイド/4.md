- 1.4 valid?とinvalid?
- Railsでオブジェクトが有効(valid)であるかどうかを検証するには、valid?メソッドを使用します。
- このメソッドは単独で使用できます。valid?を実行するとバリデーションがトリガされ、オブジェクトにエラーがない場合はtrueが返され、そうでなければfalseが返されます。
- Active Recordでバリデーションが行われた後は、errors.messagesインスタンスメソッドを使用すると、発生したエラーにアクセスできます。
- このメソッドはエラーのコレクションを返します。 定義上は、バリデーション実行後にコレクションが空になった場合は有効です。

- newを使用してインスタンス化されたオブジェクトは、仮に技術的に無効であってもエラーは報告されないので、注意が必要です。
- newではバリデーションは実行されません。
- 2.1 acceptance
- このメソッドは、フォームが送信されたときにユーザーインターフェイス上のチェックボックスがオンになっているかどうかを検証します。
- ユーザーにサービス利用条項への同意、何らかの文書に目を通すことなどを義務付けるのに使用するのが典型的な利用法です。
- このバリデーションはWebアプリケーション特有のものなので、'acceptance'はデータベースに保存する必要はありません。
- 保存用のフィールドを作成しなかった場合、ヘルパーは単に仮想の属性を作成します。
- 2.2 validates_associated
- モデルが他のモデルに関連付けられていて、両方のモデルに対してバリデーションを実行する必要がある場合はこのヘルパーを使用します。
- オブジェクトを保存しようとすると、関連付けられているオブジェクトごとにvalid?が呼び出されます。
- 2.3 confirmation
- このヘルパーは、2つのテキストフィールドが完全に一致する内容を受け取る必要がある場合に使用します。
- たとえば、メールアドレスやパスワードで、確認フィールドを使用するとします。
- このバリデーションヘルパーは仮想の属性を作成します。
- その属性の名前は、確認したい属性名に `_confirmation` を追加したものになります。
```ruby
class Person < ActiveRecord::Base
  validates :email, confirmation: true
end
```
- ビューテンプレートで以下のようなフィールドを用意します。
```ruby
<%= text_field :person, :email %>
<%= text_field :person, :email_confirmation %>
```
- このチェックは、email_confirmationがnilでない場合のみ実施されます。
- 確認を必須にするには、確認用の属性について存在チェックも追加しておくようにしてください。
- presenceを使用した存在チェックについてはこの後解説します。
- 2.7 length
- このヘルパーは、属性の値の長さを検証します。
- 多くのオプションがあり、長さ制限をさまざまな方法で指定できます。
```ruby
class Person < ActiveRecord::Base
  validates :name, length: { minimum: 2 }
  validates :bio, length: { maximum: 500 }
  validates :password, length: { in: 6..20 }
  validates :registration_number, length: { is: 6 }
end
```
- 使用可能な長さ制限オプションは以下のとおりです。

- :minimum - 属性はこの値より小さな値を取れません。
- :maximum - 属性はこの値より大きな値を取れません。
- :in または :within - 属性の長さは、与えられた区間以内でなければなりません。
- このオプションの値は範囲でなければなりません。
- :is - 属性の長さは与えられた値と等しくなければなりません。

- 8 バリデーションエラーをビューで表示する
- モデルを作成してバリデーションを追加し、Webのフォーム経由でそのモデルが作成できるようになったら、そのモデルでバリデーションが失敗したときにエラーメッセージを表示したくなります。

- エラーメッセージの表示方法はアプリケーションごとに異なるため、Railsではこれらのメッセージを直接生成するビューヘルパーは含まれていません。
- しかし、Railsでは一般的なバリデーションメソッドが多数提供されているので、カスタムのメソッドを作成するのは比較的簡単です。
- また、scaffoldを使用して生成を行なうと、そのモデルのエラーメッセージをすべて表示するERBがRailsによって一部の`_form.html.erb`ファイルに追加されます。

- @postという名前のインスタンス変数に保存されたモデルがあるとすると、以下のようになります。
```ruby
<% if @post.errors.any? %>
  <div id="error_explanation">
    <h2><%= pluralize(@post.errors.count, "error") %> はこの投稿の保存を禁止しています:</h2>

    <ul>
    <% @post.errors.full_messages.each do |msg| %>
      <li><%= msg %></li>
    <% end %>
    </ul>
  </div>
<% end %>
```

- また、Railsのフォームヘルパーを使用してフォームを生成した場合、あるフィールドでバリデーションエラーが発生すると、そのエントリの周りに追加の`<div>`が自動的に生成されます。

```ruby
<div class="field_with_errors">
<input id="post_title" name="post[title]" size="30" type="text" value="">
</div>
```
- このdivタグに好みのスタイルを与えることができます。Railsが生成するデフォルトのscaffoldによって、以下のCSSルールが追加されます。
```ruby
.field_with_errors {
  padding: 2px;
  background-color: red;
  display: table;
}
```
このCSSは、エラーを含むフィールドを赤い枠で囲みます。
